<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="L0 regularization for sparse weights" href="l0_regularization.html" /><link rel="prev" title="MicroCalibrate" href="intro.html" />
        <link rel="prefetch" href="_static/logo.png" as="image" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2025.07.19 -->
        <title>Calibration - MicroCalibrate documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="_static/style.css?v=91be6f8b" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="intro.html"><div class="brand">MicroCalibrate documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="intro.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">MicroCalibrate documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="#basic-usage">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="#pre-calibration-target-assessment">Pre-calibration target assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="#best-practices-for-pre-calibration-assessment">Best practices for pre-calibration assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="l0_regularization.html">L0 regularization for sparse weights</a></li>
<li class="toctree-l1"><a class="reference internal" href="l0_regularization.html#hyperparameter-tuning-for-l0-regularization">Hyperparameter tuning for L0 regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="robustness_evaluation.html">Robustness evaluation for calibration</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/calibration.ipynb" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="calibration">
<h1>Calibration<a class="headerlink" href="#calibration" title="Link to this heading">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">Calibration</span></code> class provides a way to adjust weights of observations in a dataset to match specified target values. This is commonly used in survey research and policy modeling for rebalancing datasets to better represent desired population characteristics.</p>
<p>The calibration process uses an optimization algorithm to find weights that minimize the loss between targets and totals of aggregating the targeted variables across all data records.</p>
</section>
<section id="basic-usage">
<h1>Basic usage<a class="headerlink" href="#basic-usage" title="Link to this heading">¶</a></h1>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">__init__(data,</span> <span class="pre">weights,</span> <span class="pre">targets)</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">weights</span></code> (np.ndarray): Initial weights for each observation in the dataset. Typically starts as an array of ones for equal weighting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">targets</span></code> (np.ndarray): Target values that the calibration process should achieve. These correspond to the desired weighted sums.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">estimate_matrix</span></code> (pd.DataFrame): matrix representing the contribution of each record to a given variable total.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">estimate_function</span></code> (Callable): function that produces the estimate values for each targeted variable based on the weights and the contribution of each record to said targeted variable. The standard way of doing it if not provided is <code class="docutils literal notranslate"><span class="pre">estimate_matrix</span> <span class="pre">&#64;</span> <span class="pre">weights</span></code>.</p></li>
</ul>
<p>Calibration can be easily done by initializing the <code class="docutils literal notranslate"><span class="pre">Calibration</span></code> class, and passing in the parameters above. Then the <code class="docutils literal notranslate"><span class="pre">calibrate()</span></code> method performs the actual calibration using the reweight function. This method:</p>
<ul class="simple">
<li><p>Adjusts the weights to better match the target values</p></li>
<li><p>Updates <code class="docutils literal notranslate"><span class="pre">self.weights</span></code> with the calibrated results</p></li>
<li><p>Produces a calibration log with performance metrics</p></li>
</ul>
<p>This module also supports regularization in case a sparse matrix that optimizes to reduce the data size simultaneously to calibration is desired. To use this functionality pass <code class="docutils literal notranslate"><span class="pre">regularize=True</span></code> to the <code class="docutils literal notranslate"><span class="pre">calibrate()</span></code> call. The method will update <code class="docutils literal notranslate"><span class="pre">self.sparse_weights</span></code> with the sparse calibrated results, which can then be used to drop records with a weight close to 0.</p>
</section>
</section>
<section id="example">
<h1>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h1>
<p>Below is a complete example showing how to calibrate a dataset to match income targets for specific age groups:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">microcalibrate.calibration</span><span class="w"> </span><span class="kn">import</span> <span class="n">Calibration</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">plotly.subplots</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_subplots</span>

<span class="n">calibration_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;microcalibrate.calibration&quot;</span><span class="p">)</span>
<span class="n">calibration_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="c1"># Create a sample dataset with age and income data</span>
<span class="n">random_generator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random_generator</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">120</span><span class="p">),</span> <span class="mi">71</span><span class="p">),</span> 
    <span class="s2">&quot;income&quot;</span><span class="p">:</span> <span class="n">random_generator</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">40000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">121</span><span class="p">),</span>
<span class="p">})</span>

<span class="c1"># Set initial weights (all one in this example)</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="c1"># Calculate target values: total income for age groups 20-30 and 40-50 (as an example) or employ existing targets</span>
<span class="n">targets_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s2">&quot;income_aged_20_30&quot;</span><span class="p">:</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">],</span>
    <span class="s2">&quot;income_aged_40_50&quot;</span><span class="p">:</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">],</span>
    <span class="s2">&quot;income_aged_71&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">71</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;income&quot;</span><span class="p">],</span>
<span class="p">})</span>

<span class="c1"># 15% higher than the sum of data with the original weights</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">(</span><span class="n">targets_matrix</span><span class="p">[</span><span class="s2">&quot;income_aged_20_30&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">weights</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> 
    <span class="p">(</span><span class="n">targets_matrix</span><span class="p">[</span><span class="s2">&quot;income_aged_40_50&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">weights</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> 
    <span class="p">(</span><span class="n">targets_matrix</span><span class="p">[</span><span class="s2">&quot;income_aged_71&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">weights</span> <span class="o">*</span> <span class="mf">1.15</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original weights: </span><span class="si">{</span><span class="n">weights</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original targets: </span><span class="si">{</span><span class="n">targets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Original weights: [1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1. 1.
 1.]
Original targets: [7.37032429e+08 9.76779350e+05 4.36479914e+04]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize the Calibration object</span>
<span class="n">calibrator</span> <span class="o">=</span> <span class="n">Calibration</span><span class="p">(</span>
    <span class="n">estimate_matrix</span><span class="o">=</span><span class="n">targets_matrix</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> 
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">noise_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">528</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">dropout_rate</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Perform the calibration</span>
<span class="n">performance_df</span> <span class="o">=</span> <span class="n">calibrator</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original dataset size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">targets_matrix</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calibrated dataset size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">calibrator</span><span class="o">.</span><span class="n">estimate_matrix</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of calibrated weights: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">calibrator</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Target income_aged_20_30 (7.37e+08) differs from initial estimate (7.37e+05) by 3.00 orders of magnitude.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Target income_aged_71 is supported by only 0.83% of records in the loss matrix. This may make calibration unstable or ineffective.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.34, weights_mean=1.03, weights_std=0.0146, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.333, weights_mean=1.06, weights_std=0.0522, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.333, weights_mean=1.09, weights_std=0.0942, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.332, weights_mean=1.11, weights_std=0.134, weights_min=1] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.332, weights_mean=1.13, weights_std=0.188, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.332, weights_mean=1.16, weights_std=0.253, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.332, weights_mean=1.19, weights_std=0.331, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.332, weights_mean=1.23, weights_std=0.424, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.332, weights_mean=1.28, weights_std=0.534, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.331, weights_mean=1.33, weights_std=0.667, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.331, weights_mean=1.4, weights_std=0.827, weights_min=1] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.331, weights_mean=1.48, weights_std=1.02, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.33, weights_mean=1.58, weights_std=1.26, weights_min=1] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.33, weights_mean=1.7, weights_std=1.55, weights_min=1] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.329, weights_mean=1.85, weights_std=1.92, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.328, weights_mean=2.04, weights_std=2.38, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.327, weights_mean=2.28, weights_std=2.95, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.326, weights_mean=2.59, weights_std=3.68, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/528 [00:00&lt;?, ?epoch/s, loss=0.324, weights_mean=2.98, weights_std=4.62, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.324, weights_mean=2.98, weights_std=4.62, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.322, weights_mean=3.48, weights_std=5.82, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.319, weights_mean=4.12, weights_std=7.37, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.315, weights_mean=4.97, weights_std=9.4, weights_min=1] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.311, weights_mean=6.07, weights_std=12.1, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.304, weights_mean=7.53, weights_std=15.5, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.296, weights_mean=9.46, weights_std=20.2, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.285, weights_mean=12, weights_std=26.4, weights_min=1]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.271, weights_mean=15.5, weights_std=34.6, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.253, weights_mean=20.1, weights_std=45.7, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.229, weights_mean=26.2, weights_std=60.5, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.2, weights_mean=34.5, weights_std=80.3, weights_min=1]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.163, weights_mean=45.5, weights_std=107, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.121, weights_mean=60, weights_std=142, weights_min=1]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.0758, weights_mean=78.7, weights_std=187, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.035, weights_mean=101, weights_std=241, weights_min=1]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.00827, weights_mean=126, weights_std=301, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.000109, weights_mean=147, weights_std=350, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.0007, weights_mean=156, weights_std=373, weights_min=1]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  36%|███▌      | 190/528 [00:00&lt;00:00, 1894.34epoch/s, loss=0.000507, weights_mean=155, weights_std=371, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=0.000507, weights_mean=155, weights_std=371, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=4.3e-5, weights_mean=151, weights_std=361, weights_min=1]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=9.75e-6, weights_mean=149, weights_std=355, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=2.09e-5, weights_mean=148, weights_std=354, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=4.83e-6, weights_mean=149, weights_std=356, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=3.25e-9, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=6.65e-7, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=2.92e-7, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=6.33e-9, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=1.88e-8, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=1.41e-8, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=8.84e-10, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=5.09e-10, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=6.26e-10, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=5.88e-11, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  72%|███████▏  | 380/528 [00:00&lt;00:00, 1882.04epoch/s, loss=1.49e-11, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 528/528 [00:00&lt;00:00, 1891.34epoch/s, loss=1.49e-11, weights_mean=150, weights_std=357, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Original dataset size: 121
Calibrated dataset size: 121
Number of calibrated weights: 121
</pre></div>
</div>
</div>
</div>
</section>
<section id="pre-calibration-target-assessment">
<h1>Pre-calibration target assessment<a class="headerlink" href="#pre-calibration-target-assessment" title="Link to this heading">¶</a></h1>
<p>Before running the calibration, it’s important to understand whether your targets are achievable and well-posed. The Calibration class provides a key method for this:</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">assess_analytical_solution()</span></code></strong> - Analyzes the mathematical difficulty of achieving your target combination</p>
<p>Additionally, you should manually check for:</p>
<ul class="simple">
<li><p>Order of magnitude differences between targets</p></li>
<li><p>Highly correlated targets</p></li>
<li><p>Redundant or conflicting constraints</p></li>
</ul>
<section id="analytical-solution-assessment">
<h2>Analytical solution assessment<a class="headerlink" href="#analytical-solution-assessment" title="Link to this heading">¶</a></h2>
<p>The analytical solution assessment examines the optimization difficulty by using the Moore-Penrose inverse for a least squares solution. It shows:</p>
<ul class="simple">
<li><p>How the loss increases as each target is added</p></li>
<li><p>Which targets contribute most to the optimization difficulty</p></li>
<li><p>Targets with large delta_loss values that complicate calibration</p></li>
</ul>
<p>This is particularly useful when you have many correlated targets or when targets overlap (e.g., total income includes all regional incomes).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assess the analytical solution before calibration</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Assessing analytical solution feasibility...&quot;</span><span class="p">)</span>
<span class="n">analytical_assessment</span> <span class="o">=</span> <span class="n">calibrator</span><span class="o">.</span><span class="n">assess_analytical_solution</span><span class="p">()</span>

<span class="c1"># Display the assessment results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ANALYTICAL SOLUTION ASSESSMENT&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This shows how the loss increases as each target is added:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">analytical_assessment</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Targets with large delta_loss values complicate the optimization problem.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Assessing analytical solution feasibility...

============================================================
ANALYTICAL SOLUTION ASSESSMENT
============================================================

This shows how the loss increases as each target is added:
     target_added         loss    delta_loss
income_aged_20_30 0.000000e+00           NaN
income_aged_40_50 7.105434e-15  7.105434e-15
   income_aged_71 4.736956e-15 -2.368478e-15

Targets with large delta_loss values complicate the optimization problem.
</pre></div>
</div>
</div>
</div>
</section>
<section id="understanding-the-assessment">
<h2>Understanding the assessment<a class="headerlink" href="#understanding-the-assessment" title="Link to this heading">¶</a></h2>
<p>The assessment provides several key insights:</p>
<ol class="arabic simple">
<li><p><strong>Condition number</strong>: Values above 1e10 suggest numerical instability. High condition numbers mean small changes in targets can lead to large changes in weights.</p></li>
<li><p><strong>Rank analysis</strong>: If the rank is less than the number of targets, some targets are redundant or conflicting.</p></li>
<li><p><strong>Recommendations</strong>: The assessment provides specific guidance based on the analysis.</p></li>
</ol>
</section>
<section id="target-tolerance-checking">
<h2>Target tolerance checking<a class="headerlink" href="#target-tolerance-checking" title="Link to this heading">¶</a></h2>
<p>Another important pre-calibration check is to ensure your targets are on similar scales. Targets that differ by many orders of magnitude can cause convergence issues.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check for order of magnitude differences in targets</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Checking target scales...&quot;</span><span class="p">)</span>

<span class="c1"># Manually check for large differences in target scales</span>
<span class="n">target_values</span> <span class="o">=</span> <span class="n">targets</span>
<span class="n">target_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;income_aged_20_30&quot;</span><span class="p">,</span> <span class="s2">&quot;income_aged_40_50&quot;</span><span class="p">,</span> <span class="s2">&quot;income_aged_71&quot;</span><span class="p">]</span>

<span class="c1"># Calculate order of magnitude for each target</span>
<span class="n">orders_of_magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">target_values</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
<span class="n">median_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">orders_of_magnitude</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Target scale analysis:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_names</span><span class="p">):</span>
    <span class="n">order_diff</span> <span class="o">=</span> <span class="n">orders_of_magnitude</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">median_order</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> (order difference from median: </span><span class="si">{</span><span class="n">order_diff</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    
<span class="c1"># Identify targets with extreme scale differences</span>
<span class="n">large_scale_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">orders_of_magnitude</span> <span class="o">-</span> <span class="n">median_order</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span>
<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">large_scale_diff</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">⚠️ WARNING: The following targets differ by more than 3 orders of magnitude from the median:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">large_scale_diff</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">target_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">target_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Consider rescaling these targets for better numerical stability.&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✓ All targets are within reasonable scale differences&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Checking target scales...

Target scale analysis:
  income_aged_20_30: 7.37e+08 (order difference from median: 2.9)
  income_aged_40_50: 9.77e+05 (order difference from median: 0.0)
  income_aged_71: 4.36e+04 (order difference from median: -1.3)

✓ All targets are within reasonable scale differences
</pre></div>
</div>
</div>
</div>
</section>
<section id="interpreting-tolerance-warnings">
<h2>Interpreting tolerance warnings<a class="headerlink" href="#interpreting-tolerance-warnings" title="Link to this heading">¶</a></h2>
<p>The tolerance check identifies targets that:</p>
<ul class="simple">
<li><p>Differ by more than 3 orders of magnitude from the median target</p></li>
<li><p>May cause numerical instability during optimization</p></li>
<li><p>Should potentially be rescaled or reviewed</p></li>
</ul>
<p>In our example, we have one target that is much larger than the others (income_aged_20_30), which the system warns about. This is expected since we artificially multiplied it by 1000 in our setup.</p>
</section>
<section id="excluded-targets">
<h2>Excluded targets<a class="headerlink" href="#excluded-targets" title="Link to this heading">¶</a></h2>
<p>If the pre-calibration assessment identifies problematic targets, you can exclude them from calibration:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: Excluding problematic targets</span>
<span class="c1"># If you identify targets that cause issues, you can exclude them:</span>

<span class="c1"># Create a calibrator with excluded targets</span>
<span class="n">calibrator_with_exclusions</span> <span class="o">=</span> <span class="n">Calibration</span><span class="p">(</span>
    <span class="n">estimate_matrix</span><span class="o">=</span><span class="n">targets_matrix</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> 
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">excluded_targets</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;income_aged_71&quot;</span><span class="p">],</span>  <span class="c1"># Exclude the smallest target</span>
    <span class="n">noise_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calibration setup with excluded targets:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original targets: </span><span class="si">{</span><span class="n">calibrator_with_exclusions</span><span class="o">.</span><span class="n">original_target_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Excluded targets: </span><span class="si">{</span><span class="n">calibrator_with_exclusions</span><span class="o">.</span><span class="n">excluded_targets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Active targets for calibration: </span><span class="si">{</span><span class="n">calibrator_with_exclusions</span><span class="o">.</span><span class="n">target_names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of active targets: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">calibrator_with_exclusions</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calibration setup with excluded targets:
Original targets: [&#39;income_aged_20_30&#39; &#39;income_aged_40_50&#39; &#39;income_aged_71&#39;]
Excluded targets: [&#39;income_aged_71&#39;]
Active targets for calibration: [&#39;income_aged_20_30&#39; &#39;income_aged_40_50&#39;]
Number of active targets: 2
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="best-practices-for-pre-calibration-assessment">
<h1>Best practices for pre-calibration assessment<a class="headerlink" href="#best-practices-for-pre-calibration-assessment" title="Link to this heading">¶</a></h1>
<ol class="arabic simple">
<li><p><strong>Always run analytical assessment first</strong> - This helps identify fundamental issues with your target specification before spending time on calibration.</p></li>
<li><p><strong>Check target scales</strong> - Targets that differ by many orders of magnitude should be rescaled or normalized to improve convergence.</p></li>
<li><p><strong>Look for redundant targets</strong> - If targets are highly correlated or mathematically dependent, consider removing redundant ones.</p></li>
<li><p><strong>Consider the degrees of freedom</strong> - Having more targets than observations makes exact calibration impossible. The system will find a best-fit solution.</p></li>
<li><p><strong>Use exclusions strategically</strong> - Temporarily exclude problematic targets to get initial calibration working, then gradually add them back.</p></li>
<li><p><strong>Monitor condition numbers</strong> - High condition numbers (&gt;1e10) indicate numerical instability. Consider reformulating your targets or adding regularization.</p></li>
</ol>
<p>Now let’s proceed with the actual calibration:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate final weighted totals</span>
<span class="n">final_totals</span> <span class="o">=</span> <span class="n">targets_matrix</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">calibrator</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target totals: </span><span class="si">{</span><span class="n">targets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Final calibrated totals: </span><span class="si">{</span><span class="n">final_totals</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Difference: </span><span class="si">{</span><span class="n">final_totals</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">targets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Relative error: </span><span class="si">{</span><span class="p">(</span><span class="n">final_totals</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">targets</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">targets</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Target totals: [7.37032429e+08 9.76779350e+05 4.36479914e+04]
Final calibrated totals: [7.37025395e+08 9.76778381e+05 4.36469951e+04]
Difference: [-7.03315457e+03 -9.68537386e-01 -9.96308503e-01]
Relative error: [-9.54253069e-04 -9.91562103e-05 -2.28259874e-03]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span>
        <span class="n">final_totals</span><span class="p">,</span>
        <span class="n">targets</span><span class="p">,</span>
        <span class="n">rtol</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>  <span class="c1"># relative tolerance</span>
        <span class="n">err_msg</span><span class="o">=</span><span class="s2">&quot;Calibrated totals do not match target values&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">performance_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>epoch</th>
      <th>loss</th>
      <th>target_name</th>
      <th>target</th>
      <th>estimate</th>
      <th>error</th>
      <th>abs_error</th>
      <th>rel_abs_error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.339973</td>
      <td>income_aged_20_30</td>
      <td>7.370324e+08</td>
      <td>7.595607e+05</td>
      <td>-7.362729e+08</td>
      <td>7.362729e+08</td>
      <td>0.998969</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0.339973</td>
      <td>income_aged_40_50</td>
      <td>9.767794e+05</td>
      <td>8.704239e+05</td>
      <td>-1.063554e+05</td>
      <td>1.063554e+05</td>
      <td>0.108884</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0.339973</td>
      <td>income_aged_71</td>
      <td>4.364799e+04</td>
      <td>3.925501e+04</td>
      <td>-4.392980e+03</td>
      <td>4.392980e+03</td>
      <td>0.100646</td>
    </tr>
    <tr>
      <th>3</th>
      <td>52</td>
      <td>0.332143</td>
      <td>income_aged_20_30</td>
      <td>7.370324e+08</td>
      <td>1.320321e+06</td>
      <td>-7.357121e+08</td>
      <td>7.357121e+08</td>
      <td>0.998209</td>
    </tr>
    <tr>
      <th>4</th>
      <td>52</td>
      <td>0.332143</td>
      <td>income_aged_40_50</td>
      <td>9.767794e+05</td>
      <td>9.767939e+05</td>
      <td>1.450000e+01</td>
      <td>1.450000e+01</td>
      <td>0.000015</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g20</span> <span class="o">=</span> <span class="n">performance_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;target_name == &#39;income_aged_20_30&#39;&quot;</span><span class="p">)</span>
<span class="n">g40</span> <span class="o">=</span> <span class="n">performance_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;target_name == &#39;income_aged_40_50&#39;&quot;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span>
    <span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">subplot_titles</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;Estimate vs target: income_aged_20_30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Estimate vs target: income_aged_40_50&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Relative absolute error: income_aged_20_30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Relative absolute error: income_aged_40_50&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">vertical_spacing</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span>
    <span class="n">horizontal_spacing</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">g20</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">g20</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Target 20-30&quot;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">g20</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">g20</span><span class="p">[</span><span class="s2">&quot;estimate&quot;</span><span class="p">],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimate 20-30&quot;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">g40</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">g40</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Target 40-50&quot;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">g40</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">g40</span><span class="p">[</span><span class="s2">&quot;estimate&quot;</span><span class="p">],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Estimate 40-50&quot;</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">g20</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">g20</span><span class="p">[</span><span class="s2">&quot;rel_abs_error&quot;</span><span class="p">],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">g40</span><span class="p">[</span><span class="s2">&quot;epoch&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">g40</span><span class="p">[</span><span class="s2">&quot;rel_abs_error&quot;</span><span class="p">],</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">),</span>
    <span class="p">),</span>
    <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1050</span><span class="p">,</span>
    <span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Calibration performance over epochs&quot;</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xanchor</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">),</span>
    <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Epoch&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Epoch&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Income ($)&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Income ($)&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Relative absolute error&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Relative absolute error&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summary</span> <span class="o">=</span> <span class="n">calibrator</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
<span class="n">summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Metric</th>
      <th>Official target</th>
      <th>Final estimate</th>
      <th>Relative error</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>income_aged_20_30</td>
      <td>7.370324e+08</td>
      <td>7.370275e+08</td>
      <td>-0.000007</td>
    </tr>
    <tr>
      <th>1</th>
      <td>income_aged_40_50</td>
      <td>9.767794e+05</td>
      <td>9.767784e+05</td>
      <td>-0.000001</td>
    </tr>
    <tr>
      <th>2</th>
      <td>income_aged_71</td>
      <td>4.364799e+04</td>
      <td>4.364699e+04</td>
      <td>-0.000023</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="summary">
<h1>Summary<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h1>
<p>The Calibration class provides comprehensive tools for survey weight calibration:</p>
<ol class="arabic simple">
<li><p><strong>Pre-calibration assessment</strong>:</p>
<ul class="simple">
<li><p>Analytical solution feasibility analysis</p></li>
<li><p>Target tolerance checking</p></li>
<li><p>Correlation analysis</p></li>
<li><p>Target exclusion capabilities</p></li>
</ul>
</li>
<li><p><strong>Standard calibration</strong>:</p>
<ul class="simple">
<li><p>Gradient-based optimization</p></li>
<li><p>Multi-target support</p></li>
<li><p>Progress monitoring</p></li>
<li><p>Performance logging</p></li>
</ul>
</li>
<li><p><strong>Advanced features</strong>:</p>
<ul class="simple">
<li><p>L0 regularization for sparse weights</p></li>
<li><p>Hyperparameter tuning (see <a class="reference internal" href="#hyperparameter_tuning.ipynb"><span class="xref myst">hyperparameter tuning notebook</span></a>)</p></li>
<li><p>Robustness evaluation (see <a class="reference internal" href="robustness_evaluation.html"><span class="std std-doc">robustness evaluation notebook</span></a>)</p></li>
</ul>
</li>
</ol>
<p>By using the pre-calibration assessment tools, you can identify and address potential issues before running the calibration, saving time and improving results. The L0 regularization feature allows you to maintain calibration accuracy while significantly reducing dataset size, which is valuable for large-scale applications.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="l0_regularization.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">L0 regularization for sparse weights</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="intro.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>