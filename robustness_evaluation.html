<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="prev" title="L0 regularization for sparse weights" href="l0_regularization.html" />
        <link rel="prefetch" href="_static/logo.png" as="image" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2025.07.19 -->
        <title>Robustness evaluation for calibration - MicroCalibrate documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="_static/style.css?v=91be6f8b" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="intro.html"><div class="brand">MicroCalibrate documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="intro.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">MicroCalibrate documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="calibration.html">Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="calibration.html#basic-usage">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="calibration.html#example">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="calibration.html#pre-calibration-target-assessment">Pre-calibration target assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="calibration.html#best-practices-for-pre-calibration-assessment">Best practices for pre-calibration assessment</a></li>
<li class="toctree-l1"><a class="reference internal" href="calibration.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="l0_regularization.html">L0 regularization for sparse weights</a></li>
<li class="toctree-l1"><a class="reference internal" href="l0_regularization.html#hyperparameter-tuning-for-l0-regularization">Hyperparameter tuning for L0 regularization</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Robustness evaluation for calibration</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/robustness_evaluation.ipynb" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section class="tex2jax_ignore mathjax_ignore" id="robustness-evaluation-for-calibration">
<h1>Robustness evaluation for calibration<a class="headerlink" href="#robustness-evaluation-for-calibration" title="Link to this heading">¶</a></h1>
<p>Evaluating the robustness of your calibration ensures that your weights will generalize well to related targets not explicitly used during calibration. This notebook demonstrates how to use the robustness evaluation feature to assess and improve calibration stability.</p>
<section id="what-is-robustness-evaluation">
<h2>What is robustness evaluation<a class="headerlink" href="#what-is-robustness-evaluation" title="Link to this heading">¶</a></h2>
<p>Robustness evaluation uses holdout validation to test how well the calibration performs on unseen targets. The process:</p>
<ol class="arabic simple">
<li><p>Randomly holds out a subset of targets</p></li>
<li><p>Calibrates on the remaining targets</p></li>
<li><p>Evaluates performance on the held-out targets</p></li>
<li><p>Repeats multiple times to assess consistency</p></li>
</ol>
<p>This helps identify whether your calibration is overfitting to specific targets or if it will generalize well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">microcalibrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">Calibration</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">calibration_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;microcalibrate.calibration&quot;</span><span class="p">)</span>
<span class="n">calibration_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="creating-a-test-dataset">
<h2>Creating a test dataset<a class="headerlink" href="#creating-a-test-dataset" title="Link to this heading">¶</a></h2>
<p>We’ll create a dataset with correlated targets to demonstrate the robustness evaluation. Some targets will be combinations of others, making them easier to predict from partial information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create synthetic data with structure</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">5000</span>

<span class="c1"># Demographics</span>
<span class="n">age</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>
<span class="n">gender</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">],</span> <span class="n">n_samples</span><span class="p">)</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;NY&#39;</span><span class="p">,</span> <span class="s1">&#39;TX&#39;</span><span class="p">,</span> <span class="s1">&#39;FL&#39;</span><span class="p">],</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">])</span>

<span class="c1"># Income (correlated with age and state)</span>
<span class="n">base_income</span> <span class="o">=</span> <span class="mi">30000</span>
<span class="n">state_multiplier</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;CA&#39;</span><span class="p">:</span> <span class="mf">1.3</span><span class="p">,</span> <span class="s1">&#39;NY&#39;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;TX&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;FL&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">}</span>
<span class="n">income</span> <span class="o">=</span> <span class="p">(</span><span class="n">base_income</span> <span class="o">+</span> <span class="p">(</span><span class="n">age</span> <span class="o">-</span> <span class="mi">18</span><span class="p">)</span> <span class="o">*</span> <span class="mi">800</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>  <span class="c1"># Ensure float type</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;NY&#39;</span><span class="p">,</span> <span class="s1">&#39;TX&#39;</span><span class="p">,</span> <span class="s1">&#39;FL&#39;</span><span class="p">]:</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">state</span> <span class="o">==</span> <span class="n">s</span>
    <span class="n">income</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*=</span> <span class="n">state_multiplier</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
<span class="n">income</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>
<span class="n">income</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">income</span><span class="p">,</span> <span class="mi">15000</span><span class="p">)</span>

<span class="c1"># Employment (correlated with age)</span>
<span class="n">emp_prob</span> <span class="o">=</span> <span class="mf">0.8</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">age</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">emp_prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">emp_prob</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Ensure valid probability range</span>
<span class="n">employed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">emp_prob</span><span class="p">)</span>

<span class="c1"># Create estimate matrix with various overlapping targets</span>
<span class="n">estimate_matrix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="c1"># State-level targets</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;NY&#39;</span><span class="p">,</span> <span class="s1">&#39;TX&#39;</span><span class="p">,</span> <span class="s1">&#39;FL&#39;</span><span class="p">]:</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">state</span> <span class="o">==</span> <span class="n">s</span>
    <span class="n">estimate_matrix</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;pop_</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">estimate_matrix</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;income_</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">income</span>
    <span class="n">estimate_matrix</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;employed_</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">employed</span>

<span class="c1"># Gender targets</span>
<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">]:</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">gender</span> <span class="o">==</span> <span class="n">g</span>
    <span class="n">estimate_matrix</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;pop_</span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">estimate_matrix</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;income_</span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">*</span> <span class="n">income</span>

<span class="c1"># Age group targets</span>
<span class="n">age_groups</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;18-35&#39;</span><span class="p">,</span> <span class="s1">&#39;36-50&#39;</span><span class="p">,</span> <span class="s1">&#39;51-65&#39;</span><span class="p">,</span> <span class="s1">&#39;65+&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">ag</span> <span class="ow">in</span> <span class="n">age_groups</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">age_groups</span> <span class="o">==</span> <span class="n">ag</span>
    <span class="n">estimate_matrix</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;pop_age_</span><span class="si">{</span><span class="n">ag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Overall targets</span>
<span class="n">estimate_matrix</span><span class="p">[</span><span class="s1">&#39;total_population&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">estimate_matrix</span><span class="p">[</span><span class="s1">&#39;total_income&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">income</span>
<span class="n">estimate_matrix</span><span class="p">[</span><span class="s1">&#39;total_employed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">employed</span>

<span class="c1"># Create realistic targets</span>
<span class="n">true_totals</span> <span class="o">=</span> <span class="n">estimate_matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="c1"># Add some noise to make calibration non-trivial</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_totals</span><span class="p">))</span>
<span class="n">targets</span> <span class="o">=</span> <span class="n">true_totals</span> <span class="o">*</span> <span class="n">noise</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset: </span><span class="si">{</span><span class="n">n_samples</span><span class="si">}</span><span class="s2"> records&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of targets: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target categories:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - State-level: 12 targets (4 states × 3 metrics)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Gender: 4 targets (2 genders × 2 metrics)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Age groups: 4 targets&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Overall: 3 targets&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Note: Many targets overlap (e.g., total_income = sum of state incomes)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset: 5000 records
Number of targets: 23
Target categories:
  - State-level: 12 targets (4 states × 3 metrics)
  - Gender: 4 targets (2 genders × 2 metrics)
  - Age groups: 4 targets
  - Overall: 3 targets

Note: Many targets overlap (e.g., total_income = sum of state incomes)
</pre></div>
</div>
</div>
</div>
</section>
<section id="basic-robustness-evaluation">
<h2>Basic robustness evaluation<a class="headerlink" href="#basic-robustness-evaluation" title="Link to this heading">¶</a></h2>
<p>Let’s evaluate the robustness of a standard calibration without regularization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize calibration</span>
<span class="n">weights_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>

<span class="n">cal</span> <span class="o">=</span> <span class="n">Calibration</span><span class="p">(</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">weights_init</span><span class="p">,</span>
    <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>
    <span class="n">estimate_matrix</span><span class="o">=</span><span class="n">estimate_matrix</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Evaluating calibration robustness...&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This will perform multiple rounds of holdout validation.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Evaluate robustness</span>
<span class="n">robustness_results</span> <span class="o">=</span> <span class="n">cal</span><span class="o">.</span><span class="n">evaluate_holdout_robustness</span><span class="p">(</span>
    <span class="n">n_holdout_sets</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>    <span class="c1"># Number of random holdout sets to test</span>
    <span class="n">holdout_fraction</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>   <span class="c1"># Hold out 30% of targets each round</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Robustness evaluation complete!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data leakage warning: Targets often share overlapping information (e.g., geographic breakdowns like &#39;snap in CA&#39; and &#39;snap in US&#39;). Holdout validation may not provide complete isolation between training and validation sets. The robustness metrics should be interpreted with this limitation in mind - they may overestimate the model&#39;s true generalization performance.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating calibration robustness...
This will perform multiple rounds of holdout validation.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=25.2, weights_mean=6.05, weights_std=2.87, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.6, weights_mean=5.99, weights_std=2.84, weights_min=0.991]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24, weights_mean=5.93, weights_std=2.81, weights_min=0.981]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.5, weights_mean=5.87, weights_std=2.79, weights_min=0.971]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.9, weights_mean=5.82, weights_std=2.76, weights_min=0.962]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.4, weights_mean=5.76, weights_std=2.73, weights_min=0.952]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.9, weights_mean=5.7, weights_std=2.71, weights_min=0.943] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.4, weights_mean=5.65, weights_std=2.68, weights_min=0.934]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.9, weights_mean=5.6, weights_std=2.66, weights_min=0.926] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.4, weights_mean=5.55, weights_std=2.63, weights_min=0.917]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20, weights_mean=5.49, weights_std=2.61, weights_min=0.909]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.5, weights_mean=5.44, weights_std=2.58, weights_min=0.9]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.1, weights_mean=5.4, weights_std=2.56, weights_min=0.892]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.7, weights_mean=5.35, weights_std=2.54, weights_min=0.884]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.3, weights_mean=5.3, weights_std=2.51, weights_min=0.877] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.9, weights_mean=5.25, weights_std=2.49, weights_min=0.869]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.5, weights_mean=5.21, weights_std=2.47, weights_min=0.861]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.1, weights_mean=5.17, weights_std=2.45, weights_min=0.854]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  88%|████████▊ | 175/200 [00:00&lt;00:00, 1742.91epoch/s, loss=17.1, weights_mean=5.17, weights_std=2.45, weights_min=0.854]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  88%|████████▊ | 175/200 [00:00&lt;00:00, 1742.91epoch/s, loss=16.8, weights_mean=5.12, weights_std=2.43, weights_min=0.847]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  88%|████████▊ | 175/200 [00:00&lt;00:00, 1742.91epoch/s, loss=16.4, weights_mean=5.08, weights_std=2.41, weights_min=0.84] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 200/200 [00:00&lt;00:00, 1739.59epoch/s, loss=16.4, weights_mean=5.08, weights_std=2.41, weights_min=0.84]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.1, weights_mean=5.93, weights_std=2.88, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.6, weights_mean=5.88, weights_std=2.85, weights_min=0.991]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23, weights_mean=5.82, weights_std=2.82, weights_min=0.981]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.5, weights_mean=5.76, weights_std=2.79, weights_min=0.971]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.9, weights_mean=5.7, weights_std=2.77, weights_min=0.962] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.4, weights_mean=5.65, weights_std=2.74, weights_min=0.953]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.9, weights_mean=5.6, weights_std=2.71, weights_min=0.943] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.5, weights_mean=5.54, weights_std=2.69, weights_min=0.934]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20, weights_mean=5.49, weights_std=2.66, weights_min=0.926]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.5, weights_mean=5.44, weights_std=2.64, weights_min=0.917]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.1, weights_mean=5.39, weights_std=2.61, weights_min=0.909]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.7, weights_mean=5.34, weights_std=2.59, weights_min=0.901]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.3, weights_mean=5.29, weights_std=2.57, weights_min=0.892]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.9, weights_mean=5.25, weights_std=2.54, weights_min=0.885]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.5, weights_mean=5.2, weights_std=2.52, weights_min=0.877] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.1, weights_mean=5.15, weights_std=2.5, weights_min=0.869]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=16.7, weights_mean=5.11, weights_std=2.48, weights_min=0.862]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=16.4, weights_mean=5.07, weights_std=2.46, weights_min=0.854]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▋ | 173/200 [00:00&lt;00:00, 1722.08epoch/s, loss=16.4, weights_mean=5.07, weights_std=2.46, weights_min=0.854]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▋ | 173/200 [00:00&lt;00:00, 1722.08epoch/s, loss=16, weights_mean=5.02, weights_std=2.44, weights_min=0.847]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▋ | 173/200 [00:00&lt;00:00, 1722.08epoch/s, loss=15.7, weights_mean=4.98, weights_std=2.41, weights_min=0.84]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 200/200 [00:00&lt;00:00, 1722.32epoch/s, loss=15.7, weights_mean=4.98, weights_std=2.41, weights_min=0.84]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=25.3, weights_mean=5.98, weights_std=2.87, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.7, weights_mean=5.92, weights_std=2.84, weights_min=0.99]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.2, weights_mean=5.86, weights_std=2.82, weights_min=0.98]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.6, weights_mean=5.81, weights_std=2.79, weights_min=0.971]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23, weights_mean=5.75, weights_std=2.76, weights_min=0.961]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.5, weights_mean=5.69, weights_std=2.73, weights_min=0.952]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22, weights_mean=5.64, weights_std=2.71, weights_min=0.943]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.5, weights_mean=5.59, weights_std=2.68, weights_min=0.934]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21, weights_mean=5.53, weights_std=2.66, weights_min=0.925]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.5, weights_mean=5.48, weights_std=2.63, weights_min=0.917]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.1, weights_mean=5.43, weights_std=2.61, weights_min=0.908]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.6, weights_mean=5.38, weights_std=2.59, weights_min=0.9]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.2, weights_mean=5.33, weights_std=2.56, weights_min=0.892]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.8, weights_mean=5.29, weights_std=2.54, weights_min=0.884]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.4, weights_mean=5.24, weights_std=2.52, weights_min=0.876]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18, weights_mean=5.19, weights_std=2.5, weights_min=0.869]   
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.6, weights_mean=5.15, weights_std=2.47, weights_min=0.861]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.2, weights_mean=5.11, weights_std=2.45, weights_min=0.854]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▋ | 173/200 [00:00&lt;00:00, 1722.08epoch/s, loss=17.2, weights_mean=5.11, weights_std=2.45, weights_min=0.854]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▋ | 173/200 [00:00&lt;00:00, 1722.08epoch/s, loss=16.9, weights_mean=5.06, weights_std=2.43, weights_min=0.846]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▋ | 173/200 [00:00&lt;00:00, 1722.08epoch/s, loss=16.5, weights_mean=5.02, weights_std=2.41, weights_min=0.839]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 200/200 [00:00&lt;00:00, 1726.14epoch/s, loss=16.5, weights_mean=5.02, weights_std=2.41, weights_min=0.839]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=25.1, weights_mean=6, weights_std=2.91, weights_min=1.01]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.5, weights_mean=5.94, weights_std=2.88, weights_min=0.996]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.9, weights_mean=5.88, weights_std=2.85, weights_min=0.986]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.3, weights_mean=5.82, weights_std=2.82, weights_min=0.976]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.8, weights_mean=5.76, weights_std=2.79, weights_min=0.967]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.3, weights_mean=5.71, weights_std=2.77, weights_min=0.958]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.7, weights_mean=5.65, weights_std=2.74, weights_min=0.948]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.2, weights_mean=5.6, weights_std=2.72, weights_min=0.939] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.8, weights_mean=5.55, weights_std=2.69, weights_min=0.931]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.3, weights_mean=5.49, weights_std=2.67, weights_min=0.922]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.8, weights_mean=5.44, weights_std=2.64, weights_min=0.914]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.4, weights_mean=5.4, weights_std=2.62, weights_min=0.905] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19, weights_mean=5.35, weights_std=2.59, weights_min=0.897] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.6, weights_mean=5.3, weights_std=2.57, weights_min=0.889]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.2, weights_mean=5.25, weights_std=2.55, weights_min=0.881]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.8, weights_mean=5.21, weights_std=2.53, weights_min=0.874]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.4, weights_mean=5.16, weights_std=2.5, weights_min=0.866] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17, weights_mean=5.12, weights_std=2.48, weights_min=0.859] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  87%|████████▋ | 174/200 [00:00&lt;00:00, 1738.15epoch/s, loss=17, weights_mean=5.12, weights_std=2.48, weights_min=0.859]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  87%|████████▋ | 174/200 [00:00&lt;00:00, 1738.15epoch/s, loss=16.7, weights_mean=5.07, weights_std=2.46, weights_min=0.851]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  87%|████████▋ | 174/200 [00:00&lt;00:00, 1738.15epoch/s, loss=16.3, weights_mean=5.03, weights_std=2.44, weights_min=0.844]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 200/200 [00:00&lt;00:00, 1737.02epoch/s, loss=16.3, weights_mean=5.03, weights_std=2.44, weights_min=0.844]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=25.1, weights_mean=5.97, weights_std=2.88, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.5, weights_mean=5.91, weights_std=2.86, weights_min=0.99]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.9, weights_mean=5.86, weights_std=2.83, weights_min=0.98]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.4, weights_mean=5.8, weights_std=2.8, weights_min=0.971] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.8, weights_mean=5.74, weights_std=2.77, weights_min=0.961]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.3, weights_mean=5.69, weights_std=2.75, weights_min=0.952]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.8, weights_mean=5.63, weights_std=2.72, weights_min=0.943]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.3, weights_mean=5.58, weights_std=2.69, weights_min=0.934]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.8, weights_mean=5.53, weights_std=2.67, weights_min=0.925]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.3, weights_mean=5.48, weights_std=2.64, weights_min=0.917]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.9, weights_mean=5.43, weights_std=2.62, weights_min=0.908]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.4, weights_mean=5.38, weights_std=2.6, weights_min=0.9]   
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19, weights_mean=5.33, weights_std=2.57, weights_min=0.892]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.6, weights_mean=5.28, weights_std=2.55, weights_min=0.884]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.2, weights_mean=5.23, weights_std=2.53, weights_min=0.876]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.8, weights_mean=5.19, weights_std=2.51, weights_min=0.869]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.4, weights_mean=5.14, weights_std=2.48, weights_min=0.861]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.1, weights_mean=5.1, weights_std=2.46, weights_min=0.854] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▌ | 172/200 [00:00&lt;00:00, 1712.10epoch/s, loss=17.1, weights_mean=5.1, weights_std=2.46, weights_min=0.854]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▌ | 172/200 [00:00&lt;00:00, 1712.10epoch/s, loss=16.7, weights_mean=5.06, weights_std=2.44, weights_min=0.847]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▌ | 172/200 [00:00&lt;00:00, 1712.10epoch/s, loss=16.4, weights_mean=5.01, weights_std=2.42, weights_min=0.839]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 200/200 [00:00&lt;00:00, 1689.18epoch/s, loss=16.4, weights_mean=5.01, weights_std=2.42, weights_min=0.839]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.7, weights_mean=5.99, weights_std=2.89, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.1, weights_mean=5.93, weights_std=2.86, weights_min=0.991]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.5, weights_mean=5.87, weights_std=2.83, weights_min=0.981]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23, weights_mean=5.81, weights_std=2.8, weights_min=0.972]   
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.4, weights_mean=5.76, weights_std=2.78, weights_min=0.962]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.9, weights_mean=5.7, weights_std=2.75, weights_min=0.953] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.4, weights_mean=5.65, weights_std=2.72, weights_min=0.944]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.9, weights_mean=5.59, weights_std=2.7, weights_min=0.935] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.4, weights_mean=5.54, weights_std=2.67, weights_min=0.926]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20, weights_mean=5.49, weights_std=2.65, weights_min=0.917]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.5, weights_mean=5.44, weights_std=2.62, weights_min=0.909]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.1, weights_mean=5.39, weights_std=2.6, weights_min=0.901] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.7, weights_mean=5.34, weights_std=2.58, weights_min=0.893]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.3, weights_mean=5.29, weights_std=2.55, weights_min=0.885]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.9, weights_mean=5.25, weights_std=2.53, weights_min=0.877]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.5, weights_mean=5.2, weights_std=2.51, weights_min=0.869] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.1, weights_mean=5.16, weights_std=2.49, weights_min=0.862]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  82%|████████▎ | 165/200 [00:00&lt;00:00, 1648.63epoch/s, loss=17.1, weights_mean=5.16, weights_std=2.49, weights_min=0.862]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  82%|████████▎ | 165/200 [00:00&lt;00:00, 1648.63epoch/s, loss=16.8, weights_mean=5.11, weights_std=2.47, weights_min=0.855]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  82%|████████▎ | 165/200 [00:00&lt;00:00, 1648.63epoch/s, loss=16.4, weights_mean=5.07, weights_std=2.44, weights_min=0.847]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  82%|████████▎ | 165/200 [00:00&lt;00:00, 1648.63epoch/s, loss=16.1, weights_mean=5.03, weights_std=2.42, weights_min=0.84] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 200/200 [00:00&lt;00:00, 1664.11epoch/s, loss=16.1, weights_mean=5.03, weights_std=2.42, weights_min=0.84]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.8, weights_mean=6.03, weights_std=2.89, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.2, weights_mean=5.97, weights_std=2.86, weights_min=0.99]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.6, weights_mean=5.91, weights_std=2.83, weights_min=0.98]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23, weights_mean=5.85, weights_std=2.8, weights_min=0.971]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.5, weights_mean=5.79, weights_std=2.77, weights_min=0.961]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22, weights_mean=5.74, weights_std=2.75, weights_min=0.952]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.5, weights_mean=5.68, weights_std=2.72, weights_min=0.943]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21, weights_mean=5.63, weights_std=2.7, weights_min=0.934]   
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.5, weights_mean=5.58, weights_std=2.67, weights_min=0.925]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20, weights_mean=5.52, weights_std=2.65, weights_min=0.917]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.6, weights_mean=5.47, weights_std=2.62, weights_min=0.908]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.2, weights_mean=5.42, weights_std=2.6, weights_min=0.9]   
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.7, weights_mean=5.38, weights_std=2.57, weights_min=0.892]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.3, weights_mean=5.33, weights_std=2.55, weights_min=0.884]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.9, weights_mean=5.28, weights_std=2.53, weights_min=0.876]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.6, weights_mean=5.23, weights_std=2.51, weights_min=0.869]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.2, weights_mean=5.19, weights_std=2.49, weights_min=0.861]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  84%|████████▍ | 169/200 [00:00&lt;00:00, 1681.12epoch/s, loss=17.2, weights_mean=5.19, weights_std=2.49, weights_min=0.861]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  84%|████████▍ | 169/200 [00:00&lt;00:00, 1681.12epoch/s, loss=16.8, weights_mean=5.15, weights_std=2.46, weights_min=0.854]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  84%|████████▍ | 169/200 [00:00&lt;00:00, 1681.12epoch/s, loss=16.5, weights_mean=5.1, weights_std=2.44, weights_min=0.847] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  84%|████████▍ | 169/200 [00:00&lt;00:00, 1681.12epoch/s, loss=16.1, weights_mean=5.06, weights_std=2.42, weights_min=0.839]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 200/200 [00:00&lt;00:00, 1680.38epoch/s, loss=16.1, weights_mean=5.06, weights_std=2.42, weights_min=0.839]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.9, weights_mean=5.99, weights_std=2.86, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.3, weights_mean=5.93, weights_std=2.83, weights_min=0.991]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.7, weights_mean=5.87, weights_std=2.8, weights_min=0.981] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.2, weights_mean=5.81, weights_std=2.77, weights_min=0.971]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.6, weights_mean=5.75, weights_std=2.75, weights_min=0.962]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.1, weights_mean=5.7, weights_std=2.72, weights_min=0.952] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.6, weights_mean=5.64, weights_std=2.69, weights_min=0.943]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.1, weights_mean=5.59, weights_std=2.67, weights_min=0.934]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.6, weights_mean=5.54, weights_std=2.64, weights_min=0.926]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.2, weights_mean=5.49, weights_std=2.62, weights_min=0.917]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.7, weights_mean=5.44, weights_std=2.59, weights_min=0.909]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.3, weights_mean=5.39, weights_std=2.57, weights_min=0.9]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.9, weights_mean=5.34, weights_std=2.55, weights_min=0.892]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.4, weights_mean=5.29, weights_std=2.53, weights_min=0.884]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.1, weights_mean=5.24, weights_std=2.5, weights_min=0.877] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.7, weights_mean=5.2, weights_std=2.48, weights_min=0.869]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.3, weights_mean=5.15, weights_std=2.46, weights_min=0.861]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=16.9, weights_mean=5.11, weights_std=2.44, weights_min=0.854]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▌ | 171/200 [00:00&lt;00:00, 1693.57epoch/s, loss=16.9, weights_mean=5.11, weights_std=2.44, weights_min=0.854]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▌ | 171/200 [00:00&lt;00:00, 1693.57epoch/s, loss=16.6, weights_mean=5.07, weights_std=2.42, weights_min=0.847]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▌ | 171/200 [00:00&lt;00:00, 1693.57epoch/s, loss=16.2, weights_mean=5.02, weights_std=2.4, weights_min=0.84]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 200/200 [00:00&lt;00:00, 1702.78epoch/s, loss=16.2, weights_mean=5.02, weights_std=2.4, weights_min=0.84]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=25.4, weights_mean=6.02, weights_std=2.9, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.8, weights_mean=5.96, weights_std=2.87, weights_min=0.993]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.2, weights_mean=5.9, weights_std=2.84, weights_min=0.983] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.7, weights_mean=5.84, weights_std=2.81, weights_min=0.973]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.1, weights_mean=5.79, weights_std=2.79, weights_min=0.964]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.6, weights_mean=5.73, weights_std=2.76, weights_min=0.954]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.1, weights_mean=5.68, weights_std=2.73, weights_min=0.945]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.6, weights_mean=5.62, weights_std=2.71, weights_min=0.936]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.1, weights_mean=5.57, weights_std=2.68, weights_min=0.928]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.6, weights_mean=5.52, weights_std=2.66, weights_min=0.919]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.1, weights_mean=5.47, weights_std=2.63, weights_min=0.911]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.7, weights_mean=5.42, weights_std=2.61, weights_min=0.902]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.3, weights_mean=5.37, weights_std=2.59, weights_min=0.894]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.8, weights_mean=5.32, weights_std=2.56, weights_min=0.886]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.4, weights_mean=5.28, weights_std=2.54, weights_min=0.878]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18, weights_mean=5.23, weights_std=2.52, weights_min=0.871]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.7, weights_mean=5.18, weights_std=2.5, weights_min=0.863]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.3, weights_mean=5.14, weights_std=2.47, weights_min=0.856]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  88%|████████▊ | 175/200 [00:00&lt;00:00, 1746.34epoch/s, loss=17.3, weights_mean=5.14, weights_std=2.47, weights_min=0.856]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  88%|████████▊ | 175/200 [00:00&lt;00:00, 1746.34epoch/s, loss=16.9, weights_mean=5.1, weights_std=2.45, weights_min=0.849] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  88%|████████▊ | 175/200 [00:00&lt;00:00, 1746.34epoch/s, loss=16.6, weights_mean=5.05, weights_std=2.43, weights_min=0.842]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 200/200 [00:00&lt;00:00, 1716.97epoch/s, loss=16.6, weights_mean=5.05, weights_std=2.43, weights_min=0.842]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=25.6, weights_mean=6.01, weights_std=2.86, weights_min=1.01]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=25, weights_mean=5.95, weights_std=2.83, weights_min=0.997] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=24.4, weights_mean=5.89, weights_std=2.8, weights_min=0.987]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.8, weights_mean=5.84, weights_std=2.78, weights_min=0.978]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=23.3, weights_mean=5.78, weights_std=2.75, weights_min=0.968]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.7, weights_mean=5.72, weights_std=2.72, weights_min=0.959]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=22.2, weights_mean=5.67, weights_std=2.7, weights_min=0.95]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.7, weights_mean=5.61, weights_std=2.67, weights_min=0.941]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=21.2, weights_mean=5.56, weights_std=2.65, weights_min=0.932]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.7, weights_mean=5.51, weights_std=2.62, weights_min=0.923]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=20.3, weights_mean=5.46, weights_std=2.6, weights_min=0.915] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.8, weights_mean=5.41, weights_std=2.57, weights_min=0.907]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19.4, weights_mean=5.36, weights_std=2.55, weights_min=0.898]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=19, weights_mean=5.31, weights_std=2.53, weights_min=0.89]   
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.6, weights_mean=5.27, weights_std=2.51, weights_min=0.883]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=18.2, weights_mean=5.22, weights_std=2.48, weights_min=0.875]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.8, weights_mean=5.18, weights_std=2.46, weights_min=0.867]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/200 [00:00&lt;?, ?epoch/s, loss=17.4, weights_mean=5.13, weights_std=2.44, weights_min=0.86] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▌ | 171/200 [00:00&lt;00:00, 1699.20epoch/s, loss=17.4, weights_mean=5.13, weights_std=2.44, weights_min=0.86]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▌ | 171/200 [00:00&lt;00:00, 1699.20epoch/s, loss=17, weights_mean=5.09, weights_std=2.42, weights_min=0.853] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:  86%|████████▌ | 171/200 [00:00&lt;00:00, 1699.20epoch/s, loss=16.7, weights_mean=5.05, weights_std=2.4, weights_min=0.846]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 200/200 [00:00&lt;00:00, 1709.95epoch/s, loss=16.7, weights_mean=5.05, weights_std=2.4, weights_min=0.846]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>============================================================
Robustness evaluation complete!
============================================================
</pre></div>
</div>
</div>
</div>
</section>
<section id="analyzing-robustness-results">
<h2>Analyzing robustness results<a class="headerlink" href="#analyzing-robustness-results" title="Link to this heading">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display overall metrics</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">robustness_results</span><span class="p">[</span><span class="s1">&#39;overall_metrics&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Overall robustness metrics:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average holdout accuracy: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;mean_holdout_accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Std dev of accuracies: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;std_holdout_accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Worst holdout accuracy: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;worst_holdout_accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Best holdout accuracy: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;best_holdout_accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generalization gap:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average training accuracy: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;mean_train_accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average holdout accuracy: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;mean_holdout_accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Gap: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;mean_train_accuracy&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;mean_holdout_accuracy&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="c1"># Calculate consistency score (1 - coefficient of variation)</span>
<span class="n">consistency_score</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;std_holdout_accuracy&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;mean_holdout_accuracy&#39;</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consistency score: </span><span class="si">{</span><span class="n">consistency_score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">/1.00&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  (Higher is better - measures stability across rounds)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overall robustness metrics:
  Average holdout accuracy: 0.0%
  Std dev of accuracies: 0.0%
  Worst holdout accuracy: 0.0%
  Best holdout accuracy: 0.0%

Generalization gap:
  Average training accuracy: 0.0%
  Average holdout accuracy: 0.0%
  Gap: 0.0%

Consistency score: 1.00/1.00
  (Higher is better - measures stability across rounds)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show target-level difficulty</span>
<span class="n">target_robustness</span> <span class="o">=</span> <span class="n">robustness_results</span><span class="p">[</span><span class="s1">&#39;target_robustness&#39;</span><span class="p">]</span>

<span class="c1"># Sort by accuracy (lower accuracy = higher difficulty)</span>
<span class="n">target_robustness</span> <span class="o">=</span> <span class="n">target_robustness</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;holdout_accuracy_rate&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Most difficult targets to predict (when held out):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">target_robustness</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)[[</span><span class="s1">&#39;target_name&#39;</span><span class="p">,</span> <span class="s1">&#39;holdout_accuracy_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;times_held_out&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Easiest targets to predict (when held out):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">target_robustness</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)[[</span><span class="s1">&#39;target_name&#39;</span><span class="p">,</span> <span class="s1">&#39;holdout_accuracy_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;times_held_out&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Most difficult targets to predict (when held out):
target_name  holdout_accuracy_rate  times_held_out
     pop_CA                    0.0               2
  income_CA                    0.0               3
employed_CA                    0.0               2
  income_NY                    0.0               1
employed_NY                    0.0               3
     pop_TX                    0.0               3
  income_TX                    0.0               2
employed_TX                    0.0               1
     pop_FL                    0.0               6
  income_FL                    0.0               3

Easiest targets to predict (when held out):
     target_name  holdout_accuracy_rate  times_held_out
   pop_age_36-50                    0.0               2
   pop_age_18-35                    0.0               1
total_population                    0.0               1
    total_income                    0.0               3
  total_employed                    0.0               3
</pre></div>
</div>
</div>
</div>
</section>
<section id="understanding-the-recommendation">
<h2>Understanding the recommendation<a class="headerlink" href="#understanding-the-recommendation" title="Link to this heading">¶</a></h2>
<p>The robustness evaluation provides actionable recommendations based on the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ROBUSTNESS EVALUATION RECOMMENDATION&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">robustness_results</span><span class="p">[</span><span class="s1">&#39;recommendation&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>

<span class="c1"># Additional analysis based on results</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">robustness_results</span><span class="p">[</span><span class="s1">&#39;overall_metrics&#39;</span><span class="p">]</span>
<span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;mean_holdout_accuracy&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Additional suggestions for poor robustness:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Consider using L0 regularization to reduce overfitting&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Review targets with highest difficulty scores&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Check for data quality issues in difficult targets&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. Consider removing highly correlated redundant targets&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;std_holdout_accuracy&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Additional suggestions for high variability:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Some target combinations may be inherently difficult&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. Consider grouping related targets&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Increase epochs to ensure convergence&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Your calibration shows good robustness!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consider saving these settings for production use.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ROBUSTNESS EVALUATION RECOMMENDATION
============================================================
❌ POOR ROBUSTNESS: The calibration shows weak generalization.
On average, 0.0% of held-out targets are within 10% of their true values.
 ⚠️ Worst-case scenario: Only 0.0% accuracy in some holdout sets.

📊 Targets with poor holdout performance (&lt;50% accuracy):
  - pop_CA: 0.0% accuracy
  - income_CA: 0.0% accuracy
  - employed_CA: 0.0% accuracy
  - income_NY: 0.0% accuracy
  - employed_NY: 0.0% accuracy

💡 RECOMMENDATIONS:
  1. Consider enabling L0 regularization for better generalization
  2. Increase the noise_level parameter to improve robustness
  3. Try increasing dropout_rate to reduce overfitting
  4. Investigate why these targets are hard to predict: pop_CA, income_CA, employed_CA
  5. Consider if these targets have sufficient support in the microdata
  6. Generalization gap of 0.1811 suggests some overfitting - consider regularization
============================================================

Additional suggestions for poor robustness:
1. Consider using L0 regularization to reduce overfitting
2. Review targets with highest difficulty scores
3. Check for data quality issues in difficult targets
4. Consider removing highly correlated redundant targets
</pre></div>
</div>
</div>
</div>
</section>
<section id="advanced-custom-holdout-strategies">
<h2>Advanced: Custom holdout strategies<a class="headerlink" href="#advanced-custom-holdout-strategies" title="Link to this heading">¶</a></h2>
<p>You can implement custom holdout strategies for specific evaluation needs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: Evaluate robustness by holding out entire target categories</span>
<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_by_category</span><span class="p">():</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;State targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">estimate_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 
                         <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">s</span> <span class="ow">in</span> <span class="n">name</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;NY&#39;</span><span class="p">,</span> <span class="s1">&#39;TX&#39;</span><span class="p">,</span> <span class="s1">&#39;FL&#39;</span><span class="p">])],</span>
        <span class="s1">&#39;Gender targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">estimate_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 
                          <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">g</span> <span class="ow">in</span> <span class="n">name</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;_M&#39;</span><span class="p">,</span> <span class="s1">&#39;_F&#39;</span><span class="p">])],</span>
        <span class="s1">&#39;Age targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">estimate_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 
                       <span class="k">if</span> <span class="s1">&#39;age&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">],</span>
        <span class="s1">&#39;Total targets&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">estimate_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> 
                         <span class="k">if</span> <span class="s1">&#39;total&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">],</span>
    <span class="p">}</span>
    
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">categories</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
            
        <span class="c1"># Create masks for train and holdout</span>
        <span class="n">train_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">targets</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">train_mask</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># Skip if too few training targets remain</span>
        <span class="k">if</span> <span class="n">train_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">continue</span>
        
        <span class="c1"># Calibrate on subset</span>
        <span class="n">cal_temp</span> <span class="o">=</span> <span class="n">Calibration</span><span class="p">(</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">weights_init</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="n">targets</span><span class="o">=</span><span class="n">targets</span><span class="p">[</span><span class="n">train_mask</span><span class="p">],</span>
            <span class="n">estimate_matrix</span><span class="o">=</span><span class="n">estimate_matrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">train_mask</span><span class="p">],</span>
            <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="c1"># Suppress logging for cleaner output</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
        <span class="n">original_level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">level</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cal_temp</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>
            
            <span class="c1"># Evaluate on holdout</span>
            <span class="n">holdout_estimates</span> <span class="o">=</span> <span class="p">(</span><span class="n">estimate_matrix</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">cal_temp</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="n">holdout_targets</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
            <span class="n">holdout_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">holdout_estimates</span> <span class="o">-</span> <span class="n">holdout_targets</span><span class="p">)</span> <span class="o">/</span> <span class="n">holdout_targets</span><span class="p">)</span>
            
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
                <span class="s1">&#39;N targets&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">),</span>
                <span class="s1">&#39;Mean error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">holdout_errors</span><span class="p">)</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s1">&#39;Max error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">holdout_errors</span><span class="p">)</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s1">&#39;Within 10%&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">holdout_errors</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">%&quot;</span>
            <span class="p">})</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Restore logging level</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">original_level</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">category_results</span> <span class="o">=</span> <span class="n">evaluate_by_category</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Robustness by target category:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">category_results</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Interpretation:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- Lower errors indicate targets that can be predicted from others&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;- High errors suggest independent information in those targets&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=24.8, weights_mean=6, weights_std=2.88, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=24.2, weights_mean=5.94, weights_std=2.85, weights_min=0.991]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=23.6, weights_mean=5.88, weights_std=2.82, weights_min=0.982]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=23.1, weights_mean=5.83, weights_std=2.79, weights_min=0.972]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=22.5, weights_mean=5.77, weights_std=2.77, weights_min=0.962]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=22, weights_mean=5.71, weights_std=2.74, weights_min=0.953]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=21.5, weights_mean=5.66, weights_std=2.71, weights_min=0.944]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=21, weights_mean=5.61, weights_std=2.69, weights_min=0.935]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=20.5, weights_mean=5.55, weights_std=2.66, weights_min=0.926]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=20.1, weights_mean=5.5, weights_std=2.64, weights_min=0.918] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 100/100 [00:00&lt;00:00, 1692.92epoch/s, loss=20.1, weights_mean=5.5, weights_std=2.64, weights_min=0.918]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=25.2, weights_mean=6, weights_std=2.86, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=24.6, weights_mean=5.94, weights_std=2.83, weights_min=0.993]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=24.1, weights_mean=5.88, weights_std=2.81, weights_min=0.983]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=23.5, weights_mean=5.82, weights_std=2.78, weights_min=0.973]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=22.9, weights_mean=5.77, weights_std=2.75, weights_min=0.964]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=22.4, weights_mean=5.71, weights_std=2.73, weights_min=0.954]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=21.9, weights_mean=5.66, weights_std=2.7, weights_min=0.945] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=21.4, weights_mean=5.6, weights_std=2.67, weights_min=0.936]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=20.9, weights_mean=5.55, weights_std=2.65, weights_min=0.928]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=20.4, weights_mean=5.5, weights_std=2.62, weights_min=0.919] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 100/100 [00:00&lt;00:00, 1728.18epoch/s, loss=20.4, weights_mean=5.5, weights_std=2.62, weights_min=0.919]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=25.9, weights_mean=6.07, weights_std=2.91, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=25.3, weights_mean=6.01, weights_std=2.88, weights_min=0.992]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=24.7, weights_mean=5.95, weights_std=2.85, weights_min=0.982]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=24.1, weights_mean=5.89, weights_std=2.82, weights_min=0.972]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=23.6, weights_mean=5.83, weights_std=2.8, weights_min=0.963] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=23, weights_mean=5.78, weights_std=2.77, weights_min=0.954] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=22.5, weights_mean=5.72, weights_std=2.74, weights_min=0.944]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=22, weights_mean=5.67, weights_std=2.72, weights_min=0.936]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=21.5, weights_mean=5.62, weights_std=2.69, weights_min=0.927]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=21, weights_mean=5.56, weights_std=2.67, weights_min=0.918]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 100/100 [00:00&lt;00:00, 1728.11epoch/s, loss=21, weights_mean=5.56, weights_std=2.67, weights_min=0.918]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=24.7, weights_mean=5.92, weights_std=2.92, weights_min=1]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=24.1, weights_mean=5.86, weights_std=2.89, weights_min=0.991]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=23.6, weights_mean=5.81, weights_std=2.87, weights_min=0.981]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=23, weights_mean=5.75, weights_std=2.84, weights_min=0.972]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=22.5, weights_mean=5.69, weights_std=2.81, weights_min=0.962]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=22, weights_mean=5.64, weights_std=2.78, weights_min=0.953]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=21.4, weights_mean=5.58, weights_std=2.76, weights_min=0.944]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=21, weights_mean=5.53, weights_std=2.73, weights_min=0.935]  
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=20.5, weights_mean=5.48, weights_std=2.7, weights_min=0.926]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress:   0%|          | 0/100 [00:00&lt;?, ?epoch/s, loss=20, weights_mean=5.43, weights_std=2.68, weights_min=0.917] 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Reweighting progress: 100%|██████████| 100/100 [00:00&lt;00:00, 1607.89epoch/s, loss=20, weights_mean=5.43, weights_std=2.68, weights_min=0.917]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Robustness by target category:
      Category  N targets Mean error Max error Within 10%
 State targets         12     449.3%    494.2%         0%
Gender targets          7     445.0%    477.2%         0%
   Age targets          4     450.4%    470.4%         0%
 Total targets          3     422.9%    425.1%         0%

Interpretation:
- Lower errors indicate targets that can be predicted from others
- High errors suggest independent information in those targets
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="best-practices-for-robustness-evaluation">
<h2>Best practices for robustness evaluation<a class="headerlink" href="#best-practices-for-robustness-evaluation" title="Link to this heading">¶</a></h2>
<section id="choose-appropriate-holdout-parameters">
<h3>1. Choose appropriate holdout parameters<a class="headerlink" href="#choose-appropriate-holdout-parameters" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Holdout fraction</strong>: 20-30% is typically good</p></li>
<li><p><strong>Number of rounds</strong>: At least 5-10 for reliable estimates</p></li>
<li><p><strong>Epochs per round</strong>: Enough to converge (check loss curves)</p></li>
</ul>
</section>
<section id="interpret-results-carefully">
<h3>2. Interpret results carefully<a class="headerlink" href="#interpret-results-carefully" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>High variability</strong>: Indicates unstable calibration</p></li>
<li><p><strong>Large generalization gap</strong>: Suggests overfitting</p></li>
<li><p><strong>Low consistency</strong>: Some target combinations are problematic</p></li>
</ul>
</section>
<section id="be-aware-of-data-leakage">
<h3>3. Be aware of data leakage<a class="headerlink" href="#be-aware-of-data-leakage" title="Link to this heading">¶</a></h3>
<p>Since many calibration targets share information (e.g., ‘total_income’ includes all state incomes), holdout validation may give optimistic results. The evaluation includes a warning about this.</p>
</section>
<section id="use-results-to-improve-calibration">
<h3>4. Use results to improve calibration<a class="headerlink" href="#use-results-to-improve-calibration" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>Add regularization if overfitting is detected</p></li>
<li><p>Remove or combine highly correlated targets</p></li>
<li><p>Investigate targets with high difficulty scores</p></li>
<li><p>Consider different optimization parameters</p></li>
</ul>
</section>
<section id="document-your-evaluation">
<h3>5. Document your evaluation<a class="headerlink" href="#document-your-evaluation" title="Link to this heading">¶</a></h3>
<p>Save robustness results along with your calibration parameters for reproducibility and comparison.</p>
</section>
</section>
<section id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Link to this heading">¶</a></h2>
<p>After evaluating robustness:</p>
<ol class="arabic simple">
<li><p>If robustness is poor, try:</p>
<ul class="simple">
<li><p>Hyperparameter tuning to find better L0 parameters</p></li>
<li><p>Reviewing and cleaning your targets</p></li>
<li><p>Increasing the dataset size</p></li>
</ul>
</li>
<li><p>If robustness is good:</p>
<ul class="simple">
<li><p>Save your calibration configuration</p></li>
<li><p>Apply to production data</p></li>
<li><p>Monitor performance over time</p></li>
</ul>
</li>
<li><p>For specific issues:</p>
<ul class="simple">
<li><p>High difficulty targets → Check data quality</p></li>
<li><p>Large generalization gap → Add regularization</p></li>
<li><p>High variability → Increase epochs or adjust learning rate</p></li>
</ul>
</li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="l0_regularization.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">L0 regularization for sparse weights</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Robustness evaluation for calibration</a><ul>
<li><a class="reference internal" href="#what-is-robustness-evaluation">What is robustness evaluation</a></li>
<li><a class="reference internal" href="#creating-a-test-dataset">Creating a test dataset</a></li>
<li><a class="reference internal" href="#basic-robustness-evaluation">Basic robustness evaluation</a></li>
<li><a class="reference internal" href="#analyzing-robustness-results">Analyzing robustness results</a></li>
<li><a class="reference internal" href="#understanding-the-recommendation">Understanding the recommendation</a></li>
<li><a class="reference internal" href="#advanced-custom-holdout-strategies">Advanced: Custom holdout strategies</a></li>
<li><a class="reference internal" href="#best-practices-for-robustness-evaluation">Best practices for robustness evaluation</a><ul>
<li><a class="reference internal" href="#choose-appropriate-holdout-parameters">1. Choose appropriate holdout parameters</a></li>
<li><a class="reference internal" href="#interpret-results-carefully">2. Interpret results carefully</a></li>
<li><a class="reference internal" href="#be-aware-of-data-leakage">3. Be aware of data leakage</a></li>
<li><a class="reference internal" href="#use-results-to-improve-calibration">4. Use results to improve calibration</a></li>
<li><a class="reference internal" href="#document-your-evaluation">5. Document your evaluation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#next-steps">Next steps</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>